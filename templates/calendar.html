{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Calendário de Eventos e Tarefas</h2>
    <div id='calendar'></div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth', 
            locale: 'pt-br',             
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
            },
            slotMinTime: '08:00:00', 
            slotMaxTime: '20:00:00', 
            height: 'auto',
            
            // NOVO: Fonte dos eventos apontando para a sua API!
            events: {
                url: '/api/calendar_events',
                method: 'GET',
                failure: function() {
                    alert('Houve um erro ao carregar os eventos!');
                }
            },
            // NOVO: Ao clicar em um evento, redireciona para a URL do evento/tarefa
            eventClick: function(info) {
                if (info.event.url) {
                    window.open(info.event.url); // Abre a URL em uma nova aba
                    info.jsEvent.preventDefault(); // Evita o comportamento padrão do navegador
                }
            },
            // NOVO: Adiciona um tooltip ao passar o mouse sobre o evento
            eventDidMount: function(info) {
                $(info.el).tooltip({
                    title: info.event.extendedProps.description || info.event.title,
                    placement: 'top',
                    trigger: 'hover',
                    container: 'body'
                });
            }
        });
        calendar.render();
    });
</script>
{% endblock %}